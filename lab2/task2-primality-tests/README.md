# Task 2: Probabilistic Primality Tests

## Описание

Реализация вероятностных тестов простоты с использованием паттерна проектирования "Шаблонный метод". Все тесты используют сервис теории чисел из задания 1.

## Архитектура

### Интерфейс PrimalityTest
`isProbablyPrime(BigInteger n, double minProbability)` → `boolean`

Параметры:
- `n` - тестируемое число
- `minProbability` - минимальная вероятность простоты в диапазоне [0.5, 1)

### Абстрактный класс AbstractPrimalityTest

Реализует паттерн "Шаблонный метод" для вероятностного тестирования:

**Общая логика (template method):**
1. Проверка граничных случаев (n < 2, n == 2, n == 3, четные числа)
2. Расчет количества итераций k на основе требуемой вероятности
3. Выполнение k итераций теста
4. Возврат результата

**Кастомизация:**
- `performSingleTest(BigInteger n)` - абстрактный метод для одной итерации теста
- `getSingleTestErrorProbability()` - вероятность ошибки одной итерации

**Вспомогательные методы:**
- `calculateIterations(double minProbability)` - расчет числа итераций: k = ⌈log(1-p) / log(ε)⌉, где ε - вероятность ошибки одной итерации
- `generateRandomWitness(BigInteger n)` - генерация случайного числа a ∈ [2, n-1]

## Реализованные тесты

### 1. Тест Ферма (FermatTest)
**Проверка:** a^(n-1) ≡ 1 (mod n) для случайного a

**Алгоритм:**
- Выбрать случайное a ∈ [2, n-1]
- Вычислить a^(n-1) mod n
- Если результат != 1, то n составное
- Если результат == 1, то n вероятно простое

**Вероятность ошибки одной итерации:** 0.5

**Слабость:** не обнаруживает числа Кармайкла (561, 1105, 1729, ...)

### 2. Тест Соловея-Штрассена (SolovayStrassenTest)
**Проверка:** a^((n-1)/2) ≡ (a/n) (mod n), где (a/n) - символ Якоби

**Алгоритм:**
- Выбрать случайное a ∈ [2, n-1]
- Вычислить символ Якоби J(a, n)
- Если J == 0, то n составное
- Вычислить a^((n-1)/2) mod n
- Если результат != J mod n, то n составное
- Иначе n вероятно простое

**Вероятность ошибки одной итерации:** 0.5

**Преимущество:** обнаруживает числа Кармайкла

### 3. Тест Миллера-Рабина (MillerRabinTest)
**Проверка:** представление n-1 = 2^s × d, проверка последовательности квадратов

**Алгоритм:**
- Представить n-1 = 2^s × d, где d нечетное
- Выбрать случайное a ∈ [2, n-1]
- Вычислить x = a^d mod n
- Если x == 1 или x == n-1, то n вероятно простое
- Повторить s-1 раз: x = x^2 mod n
  - Если x == n-1, то n вероятно простое
  - Если x == 1, то n составное
- Если не вернули true, то n составное

**Вероятность ошибки одной итерации:** 0.25

**Преимущество:** самый надежный тест, обнаруживает все числа Кармайкла

## Тесты

`PrimalityTestsTest.java` - 57 тестов, покрывающих все реализации:

**testFermat** (7 тестов):
- Проверка простых: 2, 3, 17, 97
- Проверка составных: 4, 15, 91

**testSolovayStrassen** (8 тестов):
- Проверка простых: 2, 3, 17, 97
- Проверка составных: 4, 15, 91, 561 (Кармайкл)

**testMillerRabin** (8 тестов):
- Проверка простых: 2, 3, 17, 97
- Проверка составных: 4, 15, 91, 561 (Кармайкл)

**testSmallNumbers** (4 теста):
- Граничные случаи: 0, 1, 2, 4

**testKnownPrimes** (12 тестов):
- Простые числа: 5, 7, 11, 13, 17, 19, 23, 29, 31, 1009, 10007, 104729

**testKnownComposites** (12 тестов):
- Составные числа: 4, 6, 8, 9, 10, 12, 14, 15, 16, 1001, 10001, 104730

**testCarmichaelNumbers** (6 тестов):
- Проверка, что Solovay-Strassen и Miller-Rabin корректно обнаруживают числа Кармайкла: 561, 1105, 1729

Все тесты проходят успешно.

## Демонстрация

`Demo.java` - сравнение всех трех тестов с вероятностью 0.99:

**Известные простые числа:**
- 17, 97, 1009, 10007, 104729, 15485863, 2147483647 (2^31 - 1)
- Все три теста корректно определяют как простые

**Известные составные числа:**
- 15, 91, 1001, 10001, 104730, 15485862, 561
- Все три теста корректно определяют как составные

**Специальный случай - число Кармайкла 561:**
- Демонстрация, что все тесты (включая Ферма) обнаруживают его как составное

**Большое простое число 2^31 - 1:**
- Проверка работы на больших числах

## Запуск

```bash
./run-demo.sh   # сборка + запуск демонстрации
./run-tests.sh  # сборка + запуск тестов
./build.sh      # только сборка
```

## Структура

```
lib-src/
  NumberTheoryService.java  - сервис из задания 1

src/
  PrimalityTest.java           - интерфейс
  AbstractPrimalityTest.java   - базовый класс (Template Method)
  FermatTest.java              - тест Ферма
  SolovayStrassenTest.java     - тест Соловея-Штрассена
  MillerRabinTest.java         - тест Миллера-Рабина
  Demo.java                    - демонстрация

test/
  PrimalityTestsTest.java  - тесты

out/
  production/  - скомпилированные классы
  test/        - скомпилированные тесты
```

## Сравнение тестов

| Тест               | Вероятность ошибки | Итераций для p=0.99 | Обнаруживает Кармайкла |
|--------------------|--------------------|---------------------|------------------------|
| Fermat             | 0.5                | 7                   | Нет                    |
| Solovay-Strassen   | 0.5                | 7                   | Да                     |
| Miller-Rabin       | 0.25               | 4                   | Да                     |

