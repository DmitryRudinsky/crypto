# Bit Permutation - Перестановка битов

## Описание

Реализация функции для выполнения перестановки битов в массиве байтов с использованием P-блока (блока перестановок).

## Структура проекта

```
bit-permutation/
├── src/                    # Исходный код
│   ├── BitIndexMode.java   # Enum режимов индексации
│   ├── BitPermutation.java # Основная функция перестановки
│   └── Demo.java           # Примеры использования
├── test/                   # Тесты
│   └── BitPermutationTest.java
├── build.sh                # Скрипт компиляции
├── run-demo.sh             # Запуск демонстрации
├── run-tests.sh            # Запуск тестов
└── README.md               # Документация
```

## Быстрый старт

### Компиляция

```bash
./build.sh
```

Или вручную:
```bash
# Компиляция исходников
javac -d out/production src/*.java

# Компиляция тестов
javac -d out/test -cp out/production test/*.java
```

### Запуск базовых тестов

```bash
./run-tests.sh
```

Или:
```bash
java -cp out/test:out/production BitPermutationTest
```

### Запуск стресс-тестов

```bash
./run-stress-tests.sh
```

Или:
```bash
java -cp out/test:out/production BitPermutationStressTest
```

### Запуск базовой демонстрации

```bash
./run-demo.sh
```

Или:
```bash
java -cp out/production Demo
```

### Запуск продвинутой демонстрации

```bash
./run-advanced-demo.sh
```

Или:
```bash
java -cp out/production AdvancedDemo
```

### Запуск всего сразу

```bash
./run-all.sh
```

Этот скрипт запустит все тесты и демонстрации последовательно.

## Основная функция

### Сигнатура

```java
public static byte[] permutateBits(
    byte[] data,           // Исходные данные
    int[] pBlock,          // Правило перестановки (массив индексов)
    BitIndexMode indexMode, // Режим индексации битов
    boolean zeroIndexed    // true = индексы с 0, false = индексы с 1
)
```

### Параметры

#### `data` - Массив байтов
Исходные данные для перестановки.

#### `pBlock` - P-блок (массив индексов)
Определяет правило перестановки. Каждый элемент указывает, откуда брать бит:
- `pBlock[i]` - индекс бита в исходных данных, который будет помещён на позицию `i` в результате.

#### `indexMode` - Режим индексации
- **BitIndexMode.NORMAL**: биты индексируются от LSB (младший бит) к MSB (старший бит)
  - Для байта `0b10101010`: бит 0 = 0, бит 1 = 1, ..., бит 7 = 1
- **BitIndexMode.INVERTED**: биты индексируются от MSB к LSB
  - Для байта `0b10101010`: бит 0 = 1, бит 1 = 0, ..., бит 7 = 0

#### `zeroIndexed` - Начальный индекс
- **true**: индексация начинается с 0 (0, 1, 2, 3, ...)
- **false**: индексация начинается с 1 (1, 2, 3, 4, ...)

## Примеры использования

### Пример 1: Простая реверсия байта

```java
byte[] data = {(byte) 0b11001010};
int[] pBlock = {7, 6, 5, 4, 3, 2, 1, 0};

byte[] result = BitPermutation.permutateBits(
    data, pBlock, BitIndexMode.INVERTED, true
);

// Результат: 0b01010011
```

### Пример 2: Обмен двух байтов местами

```java
byte[] data = {(byte) 0b11110000, (byte) 0b00001111};
int[] pBlock = {8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5, 6, 7};

byte[] result = BitPermutation.permutateBits(
    data, pBlock, BitIndexMode.INVERTED, true
);

// Результат: 0b00001111 0b11110000
```

### Пример 3: Индексация с 1

```java
byte[] data = {(byte) 0b10101010};
int[] pBlock = {1, 2, 3, 4, 5, 6, 7, 8}; // Индексы от 1 до 8

byte[] result = BitPermutation.permutateBits(
    data, pBlock, BitIndexMode.INVERTED, false // zeroIndexed = false
);
```

## Обработка ошибок

Функция выбрасывает `IllegalArgumentException` в следующих случаях:
- `data` равен `null` или пуст
- `pBlock` равен `null` или пуст
- Индекс в `pBlock` выходит за границы данных

## Тесты

### Базовые тесты (BitPermutationTest.java)
Набор из 6 базовых тестов покрывает:
1. Реверсия битов (MSB режим)
2. Реверсия битов (LSB режим)
3. Идентичное отображение
4. Перестановка в двух байтах
5. Индексация с 1
6. Обработка ошибок (выход за границы)

### Стресс-тесты (BitPermutationStressTest.java)
Расширенный набор из 30 тестов включает:

**Группа 1: Граничные случаи с размерами**
- 1 бит, 7 бит, 9 бит (переходы через границы байтов)
- 1 KB данных
- 10 KB данных

**Группа 2: Сложные перестановки**
- Полный реверс множественных байтов
- Чередование битов
- Разбросанные биты
- Дублирование индексов

**Группа 3: Криптографические паттерны**
- DES-подобные перестановки
- Расширяющие перестановки (32→48 бит)
- Сжимающие перестановки (64→56 бит)
- P-перестановки после S-box

**Группа 4: Обратимость**
- Обратные перестановки
- Самообратные перестановки
- Цепочки перестановок

**Группа 5: Режимы индексации**
- NORMAL vs INVERTED
- 0-based vs 1-based
- Автоопределение индексации

**Группа 6: Случайные данные**
- Малые (4 байта)
- Средние (128 байт)
- Большие (1 KB)

**Группа 7: Особые паттерны**
- Все нули, все единицы
- Чередующиеся паттерны
- Шахматные паттерны

**Группа 8: Обработка ошибок**
- Выход за границы
- Пустые данные
- Null-значения

## Сложность

- **Время**: O(n), где n - длина P-блока
- **Память**: O(m), где m - количество байтов для хранения результата

## Демонстрации

### Базовая демонстрация (Demo.java)
Показывает 5 основных примеров:
1. Реверсия всех битов в байте
2. Обмен местами двух байтов
3. Выборка только чётных битов
4. Использование индексации с 1
5. Разница между режимами NORMAL и INVERTED

### Продвинутая демонстрация (AdvancedDemo.java)
Расширенный набор из 9 демонстраций:

1. **Рассеивание битов** - показывает эффект diffusion
2. **Обмен половин** - базовая операция сети Фейстеля
3. **Расширяющая перестановка** - 32→48 бит (как в DES)
4. **Сжимающая перестановка** - 64→56 бит (PC-1 из DES)
5. **Цепочка перестановок** - 3 раунда для усиления эффекта
6. **Обратная перестановка** - вычисление и применение P⁻¹
7. **Обфускация данных** - скрытие структуры текста
8. **Визуализация рассеивания** - графическое представление
9. **Тест производительности** - измерение скорости работы

## Применение

Эта функция используется в криптографических алгоритмах, таких как:
- **DES (Data Encryption Standard)** - Initial Permutation, Final Permutation, P-boxes
- **Сети Фейстеля** - обмен половин блока
- **Расширяющие функции** - увеличение размера блока перед XOR
- **Сжимающие функции** - уменьшение размера ключа
- **Другие блочные шифры** с перестановками

## Требования

- Java 8 или выше
- Никаких внешних зависимостей

## Автор

Лабораторная работа №1 по криптографии

