# DES: Демонстрация шифрования файлов

## Описание

Комплексная демонстрация шифрования и дешифрования различных типов данных и файлов с использованием алгоритма DES, реализованного в заданиях 2-4.

## Типы демонстраций

### 1. Псевдослучайные данные

Шифрование псевдослучайных последовательностей байтов различных размеров:
- 64 байта
- 256 байт
- 1024 байта (1 КБ)
- 4096 байт (4 КБ)

**Режим:** CBC  
**Набивка:** PKCS7  
**Проверка:** SHA-256 checksum

### 2. Текстовые файлы

Шифрование текстового файла с описанием DES:
- ASCII текст
- Unicode (кириллица)
- Многострочный контент

**Режим:** CBC  
**Формат:** .txt → .txt.enc → .txt (восстановлен)

### 3. Исходный код

Шифрование файла с Java-кодом (Red-Black Tree):
- Синтаксис Java
- Комментарии и структура сохраняются
- Полное восстановление после дешифрования

**Режим:** CFB  
**Формат:** .java → .java.enc → .java (восстановлен)

### 4. Бинарные данные

Шифрование больших бинарных файлов:
- 8192 байта псевдослучайных данных
- Измерение времени шифрования/дешифрования
- Проверка целостности SHA-256

**Режим:** OFB  
**Формат:** .bin → .bin.enc → .bin (восстановлен)

### 5. Сравнение режимов

Сравнительный анализ всех режимов шифрования на одном файле:
- **ECB** - Electronic Codebook
- **CBC** - Cipher Block Chaining
- **PCBC** - Propagating CBC
- **CFB** - Cipher Feedback
- **OFB** - Output Feedback
- **CTR** - Counter

**Метрики:**
- Время шифрования
- Время дешифрования
- Размер зашифрованного файла
- Успешность восстановления

## Запуск демонстрации

```bash
cd "cipher-framework (2-nd task)"

# Компиляция (если еще не скомпилировано)
./build.sh

# Запуск демонстрации
./run-des-file-demo.sh
```

## Структура выходных данных

### Создаваемые файлы

Демонстрация создает директорию `test-files/` со следующей структурой:

```
test-files/
├── text.txt                    # Исходный текст
├── text.txt.enc                # Зашифрованный текст
├── text_decrypted.txt          # Расшифрованный текст
├── RedBlackTree.java           # Исходный код
├── RedBlackTree.java.enc       # Зашифрованный код
├── RedBlackTree_decrypted.java # Расшифрованный код
├── random.bin                  # Случайные данные
├── random.bin.enc              # Зашифрованные данные
└── random_decrypted.bin        # Расшифрованные данные
```

## Пример вывода

```
═══════════════════════════════════════════════
Пример 1: Шифрование псевдослучайных данных
═══════════════════════════════════════════════

Размер данных: 64 байт
Первые 16 байт: A3 F2 D1 8B 4C 5E 67 89 12 34 AB CD...
Зашифровано: 72 байт
Checksum исходных:      A3F2D18B4C5E...
Checksum расшифрованных: A3F2D18B4C5E...
Результат: ✓ УСПЕШНО

═══════════════════════════════════════════════
Пример 2: Шифрование текстового файла
═══════════════════════════════════════════════

Исходный файл: test-files/text.txt
Размер: 854 байт
Первые 50 символов:
The Data Encryption Standard (DES) is a symme...

Шифрование...
✓ Зашифровано: 856 байт
  Первые 16 байт шифротекста: 8A 3F 2D 1B 9C...

Дешифрование...
✓ Расшифровано: 854 байт

Проверка целостности:
  Checksum исходного:      4B3A2C1D...
  Checksum расшифрованного: 4B3A2C1D...
  Результат: ✓ УСПЕШНО

═══════════════════════════════════════════════
Пример 5: Сравнение режимов шифрования
═══════════════════════════════════════════════

Режим      | Время шифр. | Время дешифр. | Размер шифр. | Статус
-----------|-------------|---------------|--------------|--------
ECB        |        5 мс |          3 мс |       856    | ✓
CBC        |        6 мс |          4 мс |       856    | ✓
PCBC       |        7 мс |          4 мс |       856    | ✓
CFB        |        8 мс |          5 мс |       856    | ✓
OFB        |        7 мс |          4 мс |       856    | ✓
CTR        |        6 мс |          3 мс |       856    | ✓
```

## Технические детали

### Генерация ключей и IV

```java
SecureRandom random = new SecureRandom();

// Ключ DES (64 бита / 8 байт)
byte[] key = new byte[8];
random.nextBytes(key);

// Вектор инициализации (64 бита / 8 байт)
byte[] iv = new byte[8];
random.nextBytes(iv);
```

### Шифрование файла

```java
DES des = new DES();
des.setEncryptionKey(key);
des.setDecryptionKey(key);

CipherContext ctx = new CipherContext(
    des,
    CipherMode.CBC,      // Режим шифрования
    PaddingMode.PKCS7,   // Режим набивки
    8,                   // Размер блока
    iv                   // Вектор инициализации
);

// Асинхронное шифрование файла
ctx.encryptFileAsync(
    "input.txt",
    "output.txt.enc"
).join();

// Асинхронное дешифрование файла
ctx.decryptFileAsync(
    "output.txt.enc",
    "output_decrypted.txt"
).join();

ctx.shutdown();
```

### Проверка целостности

```java
MessageDigest digest = MessageDigest.getInstance("SHA-256");
byte[] hash = digest.digest(data);
```

## Использованные компоненты

### Из задания 1
- ✅ `BitPermutation` - перестановки IP, E, P, PC1, PC2

### Из задания 2
- ✅ `KeySchedule` - интерфейс расширения ключа
- ✅ `RoundFunction` - интерфейс раунд-функции
- ✅ `SymmetricCipher` - интерфейс симметричного алгоритма
- ✅ `CipherMode` - все 7 режимов шифрования
- ✅ `PaddingMode` - режимы набивки
- ✅ `CipherContext` - контекст с асинхронными операциями

### Из задания 3
- ✅ `FeistelCipher` - сеть Фейстеля

### Из задания 4
- ✅ `DES` - алгоритм DES
- ✅ `DESKeySchedule` - расширение ключа DES
- ✅ `DESRoundFunction` - функция F для DES
- ✅ `DESConstants` - константы DES

## Особенности реализации

### 1. Асинхронность

Все операции выполняются асинхронно с использованием `CompletableFuture`:

```java
CompletableFuture<Void> encryptFuture = ctx.encryptFileAsync(input, output);
encryptFuture.join(); // Ожидание завершения
```

### 2. Работа с файлами

Поддержка прямого чтения и записи файлов:

```java
ctx.encryptFileAsync(inputPath, outputPath);  // Шифрование файла
ctx.decryptFileAsync(inputPath, outputPath);  // Дешифрование файла
```

### 3. Набивка

Автоматическая набивка для блоков неполного размера:
- **PKCS7** - добавляет байты со значением размера набивки
- Автоматическое удаление при дешифровании

### 4. Различные режимы

Демонстрация всех режимов:
- **ECB** - самый простой, не требует IV
- **CBC** - цепочка блоков, требует IV
- **CFB** - потоковый, требует IV
- **OFB** - потоковый, требует IV
- **CTR** - счетчик, требует IV
- **PCBC** - распространяющаяся цепочка, требует IV

## Проверка результатов

### Целостность данных

Все демонстрации проверяют:
1. ✅ Размер данных до и после
2. ✅ SHA-256 checksum
3. ✅ Побайтовое сравнение

### Успешные критерии

- Расшифрованные данные == исходным данным
- Checksum совпадают
- Размер корректен (с учетом набивки)

## Производительность

Примерные показатели (зависят от системы):

| Размер файла | Режим | Время шифр. | Время дешифр. |
|--------------|-------|-------------|---------------|
| 1 КБ         | ECB   | 3-5 мс      | 2-4 мс        |
| 1 КБ         | CBC   | 4-6 мс      | 3-5 мс        |
| 8 КБ         | OFB   | 10-15 мс    | 8-12 мс       |

## Применение

Эта демонстрация показывает, как DES может использоваться для:

1. ✅ **Защиты конфиденциальных текстов**
2. ✅ **Шифрования исходного кода**
3. ✅ **Защиты бинарных данных**
4. ✅ **Сравнения режимов шифрования**
5. ✅ **Проверки целостности данных**

## Ограничения DES

⚠️ **Важно:** DES использует 56-битный ключ, что недостаточно для современных приложений. Эта демонстрация предназначена для образовательных целей.

Для реального использования рекомендуется:
- **3DES** (Triple DES) - тройное применение DES
- **AES** - современный стандарт шифрования

## Расширение

Демонстрацию легко расширить для:
- Шифрования изображений (PNG, JPG)
- Шифрования аудио (MP3, WAV)
- Шифрования видео (MP4, AVI)
- Больших файлов (МБ/ГБ)

Просто используйте `encryptFileAsync()` с любым типом файла!

## Заключение

Демонстрация показывает полную интеграцию всех компонентов, реализованных в заданиях 1-4:
- ✅ Перестановки битов работают корректно
- ✅ Интерфейсы реализованы правильно
- ✅ Сеть Фейстеля функционирует
- ✅ DES шифрует и дешифрует успешно
- ✅ Все режимы работают
- ✅ Файлы восстанавливаются полностью

